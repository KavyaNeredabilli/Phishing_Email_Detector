{% extends 'base.html' %}
{% block title %}History - Phishing Email Detector{% endblock %}
{% block content %}
<div class="space-y-8">
    <div class="relative overflow-hidden rounded-2xl border border-gray-100 bg-white shadow-sm p-6 sm:p-8">
        <div class="absolute inset-0 bg-gradient-to-tr from-blue-50 to-emerald-50 opacity-60 pointer-events-none"></div>
        <div class="relative">
            <h2 class="text-2xl sm:text-3xl font-semibold text-gray-900">Detection History</h2>
            <p class="mt-1 text-sm text-gray-600">Review your past detections with results and timestamps.</p>
        </div>
    </div>

    {% if logs and logs|length > 0 %}
    <div class="rounded-2xl border border-gray-100 bg-white shadow-sm p-4 sm:p-6">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Date</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Subject</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Snippet</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Result</th>
                        <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for entry in logs|reverse %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm text-gray-700 whitespace-nowrap">{{ entry.timestamp }}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 font-medium">{{ entry.subject or '—' }}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">{{ (entry.content or '')[:100].replace('\n',' ') ~ ('...' if (entry.content and entry.content|length > 100) else '') }}</td>
                        <td class="px-4 py-3">
                            {% set pred = entry.prediction %}
                            <span class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-semibold {{ 'bg-emerald-50 text-emerald-700 ring-1 ring-inset ring-emerald-200' if pred=='Legitimate' else 'bg-red-50 text-red-700 ring-1 ring-inset ring-red-200' }}">
                                {% if pred=='Legitimate' %}
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"/></svg>
                                Safe
                                {% else %}
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                Phishing
                                {% endif %}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-right">
                            <button type="button" class="inline-flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50"
                                onclick="toggleDetails('details-{{ loop.index0 }}')">
                                View Details
                            </button>
                        </td>
                    </tr>
                    <tr id="details-{{ loop.index0 }}" class="hidden">
                        <td colspan="5" class="px-4 pb-4">
                            <div class="mt-2 rounded-xl border border-gray-100 bg-gray-50 p-4 shadow-sm">
                                <div class="flex items-center justify-between gap-3 flex-wrap">
                                    <div class="text-sm text-gray-500">Date: <span class="font-medium text-gray-800">{{ entry.timestamp }}</span></div>
                                    {% set pred = entry.prediction %}
                                    <span class="inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-semibold {{ 'bg-emerald-50 text-emerald-700 ring-1 ring-inset ring-emerald-200' if pred=='Legitimate' else ('bg-yellow-50 text-yellow-700 ring-1 ring-inset ring-yellow-200' if pred=='Suspicious' else 'bg-red-50 text-red-700 ring-1 ring-inset ring-red-200') }}">
                                        {% if pred=='Legitimate' %}
                                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"/></svg>
                                        Safe
                                        {% elif pred=='Suspicious' %}
                                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3m0 3h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/></svg>
                                        Suspicious
                                        {% else %}
                                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                        Phishing
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="mt-3">
                                    <div class="text-sm text-gray-500">Subject</div>
                                    <div class="text-base font-medium text-gray-900">{{ entry.subject or '—' }}</div>
                                </div>
                                <div class="mt-3">
                                    <div class="text-sm text-gray-500">Content</div>
                                    <div class="mt-1 max-h-80 overflow-auto rounded-lg border border-gray-100 bg-white p-3 text-sm text-gray-800 whitespace-pre-wrap">{{ entry.content }}</div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="rounded-2xl border border-gray-100 bg-white shadow-sm p-6 text-center">
        <p class="text-sm text-gray-600">No history found yet.</p>
        <a href="/" class="mt-4 inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white text-sm font-semibold shadow hover:bg-blue-700">Go to Detector</a>
    </div>
    {% endif %}
</div>

<script>
function toggleDetails(id){
    var row = document.getElementById(id);
    if(!row) return;
    row.classList.toggle('hidden');
}
</script>
{% endblock %}
